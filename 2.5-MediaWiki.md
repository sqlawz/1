# Установка Docker

❗❗❗ Подключаемся по SSH с HQ-CLI на BR-SRV, вводим пароль ❗❗❗

### Вариант 1

`ssh sshuser@192.168.0.2 -p 2024`

### Вариант 2

`ssh sshuser@192.168.0.2 -p 3015`

Заходим в привилегированный режим

`sudo su`

Устанавливаем `docker`

`apt install docker.io docker-compose`

# Установка MediaWiki

***
❗❗❗ Можно пропустить до раздела [Создание compose файла](https://github.com/ewkerewka/demo2025/wiki/2.5-MediaWiki#%D1%81%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5-compose-%D1%84%D0%B0%D0%B9%D0%BB%D0%B0) ❗❗❗
***

Вбиваем в поиск "media wiki docker compose" и переходим на указанную ссылку

![{D9D4E07A-64DE-414D-BC2C-C3F3567EB2AC}](https://github.com/user-attachments/assets/f8c5db18-bcd9-449b-b27a-55828f61470b)

![{269CC090-4687-44A2-A70F-DB7E6A50E4EC}](https://github.com/user-attachments/assets/f0936c9b-c882-4afb-8500-97a4b097b3d3)

![{BF1A961E-926D-41EC-8650-4A292425EA81}](https://github.com/user-attachments/assets/4549e25a-a881-4621-bb18-205a2ff310a3)

# Создание compose файла

Переходим в директорию пользователя `locadm` и создаём файл `wiki.yml`, копируем туда выделенную конфигурацию с последнего скриншота и изменяем её

`cd /home/locadm`

`nano wiki.yml`

### Вариант 1

```
services:
  MediaWiki:
    container_name: wiki
    image: mediawiki
    restart: always
    ports: 
      - 8080:80
    links:
      - database
    volumes:
      - images:/var/www/html/images
      # - ./LocalSettings.php:/var/www/html/LocalSettings.php
  database:
    container_name: mariadb
    image: mariadb
    restart: always
    environment:
      MYSQL_DATABASE: mediawiki
      MYSQL_USER: wiki
      MYSQL_PASSWORD: WikiP@ssw0rd
      MYSQL_RANDOM_ROOT_PASSWORD: 'yes'
    volumes:
      - dbvolume:/var/lib/mariadb
volumes:
  dbvolume:
      external: true
  images:
```

### Вариант 2

```
services:
  MediaWiki:
    container_name: wiki
    image: mediawiki
    restart: always
    ports: 
      - 8086:80
    links:
      - database
    volumes:
      - images:/var/www/html/images
      # - ./LocalSettings.php:/var/www/html/LocalSettings.php
  database:
    container_name: mariadb
    image: mariadb
    restart: always
    environment:
      MYSQL_DATABASE: mediawiki
      MYSQL_USER: wiki
      MYSQL_PASSWORD: WikiP@ssw0rd
      MYSQL_RANDOM_ROOT_PASSWORD: 'yes'
    volumes:
      - dbvolume:/var/lib/mariadb
volumes:
  dbvolume:
      external: true
  images:
```

***
В конфигурацию был добавлен автоматический старт контейнера с бд, копируйте конфигурацию написанную выше в зависимости от варианта
***

***
❗СМОТРИТЕ, ЧТОБЫ ПОСЛЕ КОПИРОВАНИЯ НЕ БЫЛО ОТСТУПОВ В НАЧАЛЕ КОНФИГА, ИНАЧЕ ВЫ НЕ СМОЖЕТЕ ЗАПУСТИТЬ СТЕК КОНТЕЙНЕРОВ ❗
***

![{C843A7DB-1989-4769-AF16-A4E4E506941F}](https://github.com/user-attachments/assets/96e5e8f9-4bf9-4906-af42-05c1e5210287)

Создаём раздел базы данных

`docker volume create dbvolume`

![{CB911749-6213-4F36-A35A-C1B4166879F5}](https://github.com/user-attachments/assets/ff522e7f-e859-4b00-8f32-36e6573f1863)

Запускаем стек контейнеров

`docker-compose -f wiki.yml up -d`

![{66C91BE5-DCB7-474F-BA83-F4DE84C39F05}](https://github.com/user-attachments/assets/48c5607c-4db2-47b8-ac7b-114e54ae097e)

# Настройка в веб-интерфейсе

На `HQ-CLI` в браузере переходим по адресу `192.168.0.2:8080` или `192.168.0.2:8086` и жмём "set up the wiki"

![{72EB9949-CD4D-4DAF-BF97-19969072AF93}](https://github.com/user-attachments/assets/01d88f71-a318-4342-93fc-b942cec844b1)

Первые 2 страницы листаем вниз и жмём далее

Настройка БД, пароль вписываем соответственно `WikiP@ssw0rd`

![{102F89AE-B655-46E5-A05F-4F8680E9325C}](https://github.com/user-attachments/assets/4ed9e187-5d6f-4720-808c-921933a560d7)

Тут жмём далее

![{E2A1E9D4-E7A3-42B8-8EEF-BD03770B878E}](https://github.com/user-attachments/assets/82f42be5-dc90-4b16-935f-6b42489af3d6)

Настройка учётной записи, пароль вводим `WikiP@ssw0rd`

![{B7689AE4-580D-42E3-926F-ADEE10416B45}](https://github.com/user-attachments/assets/66f4c76f-818d-403a-b0b5-475ec69cd19f)

![{47C45C75-4E0E-4E2D-B46C-6BBEB9976B76}](https://github.com/user-attachments/assets/278eb334-06be-4337-8c4b-24bd3e544c78)

❗❗❗ На следующих страницах жмём далее и по завершению у нас скачается файл, который мы должны перекинуть на `BR-SRV` ❗❗❗

![{D2EDD060-2BEC-4959-A186-C2564EE8DAE9}](https://github.com/user-attachments/assets/0e18dfbb-d6c2-497d-953c-af37bcdfde57)

Выходим из SSH, если ещё не вышли и прописываем следующее 

### Вариант 1

`scp -P 2024 /home/locadm/Downloads/LocalSettings.php sshuser@192.168.0.2:/home/sshuser`

### Вариант 2

`scp -P 3015 /home/locadm/Downloads/LocalSettings.php sshuser@192.168.0.2:/home/sshuser`

![{6D39AD79-1EB3-4049-90AD-C7322AB96923}](https://github.com/user-attachments/assets/428b0f84-3c1a-4044-b20e-7c7bd9fcafe1)

Далее на BR-SRV перемещаем переданный файл с домашней папки sshuser в `locadm`

`mv /home/sshuser/LocalSettings.php /home/locadm/`

Переходим в домашнюю папку `locadm`, открываем `wiki.yml` и раскомменчиваем строку ( ВАЖНО ЧТОБЫ ЭТА СТРОКА БЫЛА РОВНА ПО СИМВОЛУ `-` К СТРОЧКЕ ВЫШЕ, ИНАЧЕ НИЧЕГО РАБОТАТЬ НЕ БУДЕТ )

`cd /home/locadm`

`nano wiki.yml`

![{327AB50E-3798-4E38-BF45-B548269CA645}](https://github.com/user-attachments/assets/974a08a4-4852-4e25-899a-e4edb6bcd7fa)

Перезапускаем стек контейнеров

`docker-compose -f wiki.yml stop`

`docker-compose -f wiki.yml up -d`

![{A8F9B7BB-6555-46E5-AD2B-6F27A46A8B76}](https://github.com/user-attachments/assets/6163769d-7149-4cc1-86f3-c00deb4ef3ac)

Возвращаемся на HQ-CLI и в браузере переходим по адресу `http://192.168.0.2:8080` или `http://192.168.0.2:8086` и уже должно открыться Вики, либо по `http://wiki.au-team.irpo`

![{186D63C4-042B-4CCA-943D-7731BCCB68F2}](https://github.com/user-attachments/assets/a9250977-d7e8-4574-a440-ab2053803454)

Нажимаем сверху справа "Войти" и вводим данные нашего пользователя, пароль `WikiP@ssw0rd`

![{F9E71D0E-32DC-4E11-B848-4F8184FD8BFD}](https://github.com/user-attachments/assets/098d8e65-627a-434b-9182-3a047c6b558f)

![{FA20AE15-62BC-4D1B-9499-44CCA3D2AE1E}](https://github.com/user-attachments/assets/47cc0216-f248-4363-ad0a-cf94ed919f1d)









